<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒˆ Ambilight Effect - Random Video Clips</title>
    <style>
        /* CSS styles */

        @font-face {
            font-family: 'JetBrainsMono-Bold';
            src: url('fonts/JetBrainsMono-Bold.woff2') format('woff2'), /* Modern Browsers */
                 url('fonts/JetBrainsMono-Bold.ttf') format('truetype'); /* Safari, Android, iOS */
            font-weight: 700; /* Bold font weight */
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
     
        }

        body {
            background: #000;
            overflow: hidden;
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .videoWrapper {
            top: 20px;
            width: calc(100vh - 10vh); /* 95% of the viewport height minus margin */
            height: calc(100vh - 10vh); /* 95% of the viewport height minus margin */
            margin: 10vh auto; /* 5vh margin on top and bottom */
            display: flex;

            
            
            position: relative; /* For absolute positioning of children */
        }



        .ambilightWrapper {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #video {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            aspect-ratio: 1/ 1;
        }
        .videoPlayer {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            aspect-ratio: 1 / 1;
            transition: opacity 1s ease-in-out;
            opacity: 1;
        }


        #ambilight {
            filter: blur(60px) opacity(0.5) saturate(300%);
            left: 0;
            pointer-events: none;
            position: absolute;
            top: 0;
            transform: scale(1.1) translateZ(0);
            width: 100%;
            z-index: -1;
            height: 100%;
        }

        .no-scroll {
            overflow: hidden;
        }

        button#muteButton {
            padding: 10px 20px;
            font-family: 'JetBrainsMono-Bold';
            font-size: 16px;
            background-color: rgba(0, 0, 0, 0.7); /* Black with 50% opacity */
            color: #00ffcc;
            border: 2px solid #00ffcc;
            border-radius: 20px;
            cursor: pointer;
            outline: none;
            z-index: 111111111111111111;
            position: absolute;
            bottom: 2%;
            left: 20px; /* Changed from right to left */
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.5);
            opacity: 0; /* Start hidden */
            visibility: hidden; /* Ensure it does not block clicks */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; /* Smooth transition for opacity and visibility */
        }


        .videoWrapper:hover #muteButton {
            opacity: 1;
            visibility: visible;
        }


    </style>
</head>
<body class="no-scroll">
    <div class="videoWrapper">
        <div class="ambilightWrapper">
            <div class="aspectRatio">
                <video id="video1" class="videoPlayer" autoplay muted playsinline></video>
                <video id="video2" class="videoPlayer" autoplay muted playsinline></video>
            </div>
            <canvas id="ambilight"></canvas>
        </div>
        <!-- Mute/Unmute Button -->
   
        <button id="muteButton">Unmute</button>



    </div>



    <script>
        let intervalId;
        const FRAMERATE = 30;
        let activeVideo;

        window.onload = function () {
            const canvas = document.getElementById('ambilight');
            const context = canvas.getContext('2d');

            const video1 = document.getElementById('video1');
            const video2 = document.getElementById('video2');
            activeVideo = video1; // Start with video1

            function repaintAmbilight() {
                if (activeVideo && activeVideo.readyState >= 2) {
                    context.drawImage(activeVideo, 0, 0, canvas.width, canvas.height);
                }
            }

            function startAmbilightRepaint() {
                intervalId = setInterval(repaintAmbilight, 1000 / FRAMERATE);
            }

            function stopAmbilightRepaint() {
                clearInterval(intervalId);
            }

            video1.addEventListener('play', startAmbilightRepaint);
            video2.addEventListener('play', startAmbilightRepaint);

            video1.addEventListener('pause', stopAmbilightRepaint);
            video2.addEventListener('pause', stopAmbilightRepaint);

            video1.addEventListener('ended', stopAmbilightRepaint);
            video2.addEventListener('ended', stopAmbilightRepaint);

            video1.addEventListener('seeked', repaintAmbilight);
            video2.addEventListener('seeked', repaintAmbilight);

            function toggleMute() {
                console.log('toggleMute function called'); // Debug statement

                // Log the current mute state before toggling
                console.log('Current Mute State (before toggle): Video1:', video1.muted, 'Video2:', video2.muted);

                video1.muted = !video1.muted;
                video2.muted = !video2.muted;

                document.getElementById('muteButton').innerText = video1.muted ? 'Unmute' : 'Mute';

                // Log the new mute state after toggling
                console.log('New Mute State (after toggle): Video1:', video1.muted, 'Video2:', video2.muted);
            }

            // Attach event listener to the muteButton here, inside the onload where toggleMute is defined
            document.getElementById('muteButton').addEventListener('click', toggleMute);

            const button = document.getElementById('muteButton');
            const videoWrapper = document.querySelector('.videoWrapper');

            function toggleButtonVisibility() {
                if (button.style.opacity === '1') {
                    button.style.opacity = 0;
                    button.style.visibility = 'hidden';
                } else {
                    button.style.opacity = 1;
                    button.style.visibility = 'visible';
                }
            }

            // Use touchstart for mobile devices and mouseenter/mouseleave for non-touch devices
            videoWrapper.addEventListener('touchstart', toggleButtonVisibility, {passive: true});
            videoWrapper.addEventListener('mouseenter', function() {
                button.style.opacity = 1;
                button.style.visibility = 'visible';
            });
            videoWrapper.addEventListener('mouseleave', function() {
                button.style.opacity = 0;
                button.style.visibility = 'hidden';
            });

            function adjustButtonPosition() {
                const aspectRatio = window.innerWidth / window.innerHeight;
                const targetAspectRatio = 9 / 16;
                let interpolationFactor = Math.max(0, Math.min(1, (aspectRatio - targetAspectRatio) / (1 - targetAspectRatio)));
                const bottomPosition = 24 - (22 * interpolationFactor) + '%';
                button.style.bottom = bottomPosition;
            }

            window.addEventListener('resize', adjustButtonPosition);
            adjustButtonPosition(); // Initial call to set the position        

        };
    </script>


    <script>
        async function fetchVideoUrls() {
            try {
                const response = await fetch('https://api.github.com/repos/Mischlichter/data/contents/clipz');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                return data.map(item => item.download_url);
            } catch (error) {
                console.error('Error fetching video URLs:', error);
                return [];
            }
        }

        async function setupVideoPlayer() {
            let originalVideoUrls = await fetchVideoUrls();
            if (originalVideoUrls.length === 0) {
                console.error('No video URLs found');
                return;
            }

            let videoUrls = [...originalVideoUrls];
            const video1 = document.getElementById('video1');
            const video2 = document.getElementById('video2');
            let currentVideo = video1;
            let nextVideo = video2;

            function playNextVideo() {
                if (videoUrls.length === 0) {
                    videoUrls = [...originalVideoUrls]; // Reset the list if empty
                }
                const randomIndex = Math.floor(Math.random() * videoUrls.length);
                nextVideo.src = videoUrls[randomIndex];
                nextVideo.load();
                nextVideo.play();
                videoUrls.splice(randomIndex, 1);

                activeVideo = nextVideo;

                // Start fading transition
                currentVideo.style.opacity = '0';
                nextVideo.style.opacity = '1';

                // Swap roles of video elements for next transition
                let temp = currentVideo;
                currentVideo = nextVideo;
                nextVideo = temp;
            }

            currentVideo.addEventListener('ended', playNextVideo);
            nextVideo.addEventListener('ended', playNextVideo);

            playNextVideo(); // Start the first video
        }

        setupVideoPlayer(); // Initialize the video setup
    </script>



</body>
</html>