<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            background-color: transparent;
            overflow: hidden;  /* This line hides the scrollbar */
        }
        .hidden {
            display: none;
        }


        #scene-wrapper {
            width: 100vw;
            height: 100vh;
            position: relative;
        }


        .container01 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 1s; /* Transition effect for fading */
        }

        .current-scene {
            opacity: 1; /* Fully visible */
            z-index: 1; /* Above the next scene */
        }

        .next-scene {
            opacity: 0; /* Fully transparent */
            z-index: 0; /* Below the current scene */
        }

        #next-button {
            position: absolute;
            top: 2%;
            right: 2%;
            z-index: 1000;
        }

        .info-text {
            position: absolute;
            bottom: 2%;
            left: 2%;
        }

        .viewer {
            position: absolute;
            top: 0%;
            left: 0;
            width: 100vw;  /* 100% of the viewport width */
            height: 100vh;  /* 100% of the viewport height */
        }

        #depth-viewer0 {
            
            top: 0;
            left: 0;
            
            
        }

        #depth-viewer1 {
            top: 0;
            left: 0;
        }

        .canvas {

            border: 50px solid black;
        }

    </style>
</head>
<body>
    <div id="wrapper" class="hidden">

        <!-- Scene Wrapper to hold the current scene -->
        <div id="scene-wrapper">
            <!-- Current Scene Container -->
            <section class="container01 current-scene">
                <!-- Depth Map Viewer Containers for the current scene will be dynamically created here -->
            </section>
        </div>
        
        <!-- Add other elements here -->
    </div>

    <!-- Dependencies -->
    <script src="scripts/pixi.4.8.9.js"></script>
    <script src="scripts/DepthyViewerlarge.min.js"></script>
    <script src="scripts/index-min.js"></script>

    <script>
        var isVisible=!1,mouseX=0,mouseY=0,scaleMFactor=5e-4,container=document.querySelector(".current-scene"),isMouseInArea=!1,smoothingFactor=0,options={pauseRender:!1},initialContainerWidth=(window.addEventListener("message",event=>{if(event.data&&event.data.type)switch(event.data.type){case"mousemove":case"click":mouseX=event.data.mouseX*scaleMFactor,mouseY=event.data.mouseY*scaleMFactor}}),container.offsetWidth);function handleMouseEnter(e){isMouseInArea=!0,smoothingFactor=.8;var interval=setInterval(function(){smoothingFactor-=.02,smoothingFactor<=0&&(smoothingFactor=0,clearInterval(interval))},20)}function handleMouseLeave(e){isMouseInArea=!1}function handleMouseMove(e){var currentContainerWidth=container.offsetWidth,scale=initialContainerWidth/currentContainerWidth,rect=container.getBoundingClientRect(),normalizedMouseX=e.clientX-rect.left-currentContainerWidth/2,e=e.clientY-rect.top-currentContainerWidth/(16/9)/2;mouseX=normalizedMouseX*(scaleMFactor*scale),mouseY=e*(scaleMFactor*scale)}function attachMouseListeners(){container.removeEventListener("mouseenter",handleMouseEnter),container.removeEventListener("mouseleave",handleMouseLeave),container.removeEventListener("mousemove",handleMouseMove),container.addEventListener("mouseenter",handleMouseEnter),container.addEventListener("mouseleave",handleMouseLeave),container.addEventListener("mousemove",handleMouseMove)}attachMouseListeners();var targetMouseX=0,targetMouseY=0;function smoothMouseMovement(){var deltaX=targetMouseX-mouseX,deltaY=targetMouseY-mouseY;isMouseInArea&&(mouseX+=deltaX*smoothingFactor,mouseY+=deltaY*smoothingFactor),targetMouseX=mouseX,targetMouseY=mouseY,requestAnimationFrame(smoothMouseMovement)}smoothMouseMovement();const imageCache={},cacheName="site-assets";async function initializeCacheStatus(urls){const cache=await caches.open(cacheName),cachePromises=urls.map(async url=>{const response=await cache.match(url),cacheKey="cache_"+url;response?localStorage.setItem(cacheKey,"cached"):localStorage.setItem(cacheKey,"not_cached")});await Promise.all(cachePromises)}async function getCachedOrFetchImage(url){const cache=await caches.open(cacheName),cacheKey="cache_"+url,cacheStatus=localStorage.getItem(cacheKey);if("cached"===cacheStatus){const cachedResponse=await cache.match(url);if(cachedResponse)return URL.createObjectURL(await cachedResponse.blob())}const response=await fetch(url);return response.ok?(await cache.put(url,response.clone()),localStorage.setItem(cacheKey,"cached"),URL.createObjectURL(await response.blob())):url}async function preloadAndCacheImage(url){if(imageCache[url])return imageCache[url];const blobURL=await getCachedOrFetchImage(url);return imageCache[url]=blobURL,blobURL}async function preloadAssetsForScene(sceneKey){const scene=assets[sceneKey],preloadPromises=[];for(var number in scene)scene[number].image&&preloadPromises.push(preloadAndCacheImage(scene[number].image.url)),scene[number].depthmap&&preloadPromises.push(preloadAndCacheImage(scene[number].depthmap.url));await Promise.all(preloadPromises)}let assets,viewerContainers=[];async function loadAssets(){assets={};const response=await fetch("https://raw.githubusercontent.com/Mischlichter/data/main/assets/assets.txt"),text=await response.text(),scenes=text.trim().split("\n\n");scenes.forEach(sceneText=>{const lines=sceneText.trim().split("\n"),sceneKey=lines[0].slice(0,-1);assets[sceneKey]={};for(let i=1;i<lines.length;i++){const[key,urlPart]=lines[i].split("=");if(key&&urlPart){const colons=[...urlPart.matchAll(/:/g)].map(match=>match.index);let url,scaleFactor,xbase,ybase;ybase=3<=colons.length?(url=urlPart.slice(0,colons[colons.length-3]),scaleFactor=urlPart.slice(colons[colons.length-3]+1,colons[colons.length-2])||"1",xbase=urlPart.slice(colons[colons.length-2]+1,colons[colons.length-1])||"0",urlPart.slice(colons[colons.length-1]+1)||"0"):(url=urlPart,scaleFactor="1",xbase="0","0");const type=key.slice(0,3),number=key.slice(3),assetObj=(assets[sceneKey][number]||(assets[sceneKey][number]={}),{url:url,scaleFactor:parseFloat(scaleFactor),xbase:parseFloat(xbase),ybase:parseFloat(ybase)});"IMG"===type?assets[sceneKey][number].image=assetObj:"DMP"===type&&(assets[sceneKey][number].depthmap=assetObj)}}})}async function displayScene(sceneKey){const scene=assets[sceneKey],currentContainer=document.querySelector(".current-scene");currentContainer.innerHTML="",viewerContainers=[],await preloadAssetsForScene(sceneKey),Object.keys(scene).forEach((key,index)=>{const viewerContainer=document.createElement("div"),viewer=(viewerContainer.id="depth-viewer"+index,viewerContainer.className="viewer",viewerContainer.style.top=scene[key].image.xbase+"%",viewerContainer.style.left=scene[key].image.ybase+"%",currentContainer.appendChild(viewerContainer),new DepthyViewer(viewerContainer,{}));viewer.setImage(imageCache[scene[key].image.url]||scene[key].image.url),viewer.setDepthmap(imageCache[scene[key].depthmap.url]||scene[key].depthmap.url),viewer.setScaleFactor(scene[key].image.scaleFactor),viewer.setxbase(scene[key].image.xbase),viewer.setybase(scene[key].image.ybase),viewerContainers.push(viewer)}),container=document.querySelector(".current-scene"),attachMouseListeners()}function getSceneKeyFromURL(){const urlParams=new URLSearchParams(window.location.search);return urlParams.get("scene")||"scene01"}async function setup(){await loadAssets();const sceneKey=getSceneKeyFromURL();await preloadAssetsForScene(sceneKey),displayScene(sceneKey),window.parent.postMessage("iframeLoaded","*")}function handleVisibilityChange(isVisible){viewerContainers.forEach(viewer=>{viewer.setPauseRender(!isVisible)})}window.addEventListener("message",event=>{event.origin===window.location.origin&&"visibilityChange"===event.data.type&&handleVisibilityChange(event.data.isVisible)}),setup();
    </script>
    <script>
        window.addEventListener('load', function() {
            document.getElementById('wrapper').classList.remove('hidden');
        });
    </script>

</body>
</html>
